flowchart LR

  %% ==========================================================
  %% MULTI AGENT ARCHITECTURE (Clean + High Detail)
  %% ==========================================================

  %% ---------------------------
  %% User / Interface Layer
  %% ---------------------------
  subgraph UI["User & Interface Layer"]
    U1[ğŸ‘¤ User<br/>Lawyer / Citizen / Student]
    WEB[ğŸŒ Streamlit UI]
    API[âš¡ FastAPI Gateway]
  end

  %% ---------------------------
  %% Orchestration Layer
  %% ---------------------------
  subgraph ORCH["Orchestration & Control Plane"]
    LRA[ğŸ§  LRA<br/>Legal Reasoning Orchestrator]
    ROUTER[ğŸ”€ Task Router<br/>Intent + Agent Selection]
    STATE[ğŸ—‚ï¸ Session State<br/>Conversation Memory]
    POLICY[ğŸ›¡ï¸ Safety + Policy Guard<br/>Hallucination & Abuse Filter]
    AUDIT[ğŸ“œ Audit Logger<br/>Trace + Evidence Capture]
  end

  %% ---------------------------
  %% Agent Layer
  %% ---------------------------
  subgraph AGENTS["Agent Execution Layer"]
    CLSA[ğŸ” CLSA<br/>Case Law Search Agent]
    LII[ğŸ§© LII<br/>Legal Issue Identifier]
    LAA[â³ LAA<br/>Limitation Analysis Agent]
    LAB[âš”ï¸ LAB<br/>Legal Argument Builder]
    DGA[ğŸ“ DGA<br/>Draft Generator Agent]
    CCA[âœ… CCA<br/>Compliance Check Agent]
    LAF[ğŸ¤ LAF<br/>Legal Aid Finder Agent]
  end

  %% ---------------------------
  %% Retrieval Layer
  %% ---------------------------
  subgraph RET["Retrieval & Knowledge Layer"]
    RETR[ğŸ“Œ Retrieval Engine<br/>Hybrid Search]
    VDB[(ğŸ“š Vector Store<br/>Chroma / FAISS)]
    META[(ğŸ—ƒï¸ Metadata Index<br/>SQLite / JSON)]
    DOCS[(ğŸ“‚ Document Store<br/>PDF / HTML / Text)]
    CIT[ğŸ”— Citation Validator<br/>Source Proof]
  end

  %% ---------------------------
  %% Data Ingestion Pipeline
  %% ---------------------------
  subgraph ING["Data Ingestion Pipeline"]
    SRC[ğŸŒ Sources<br/>SC / HC / Tribunals]
    SCRAPE[ğŸ•¸ï¸ Scraper + Downloader]
    PARSE[ğŸ“„ Parser<br/>HTML / PDF / OCR]
    CLEAN[ğŸ§¼ Cleaner + Normalizer]
    CHUNK[âœ‚ï¸ Chunking Engine]
    EMB[ğŸ§  Embedding Generator]
    LOAD[ğŸ“¥ Loader to Vector Store]
  end

  %% ---------------------------
  %% LLM / External Services
  %% ---------------------------
  subgraph EXT["External Services"]
    LLM[ğŸ¤– LLM Provider<br/>OpenAI / HuggingFace]
    OCR[ğŸ”  OCR Engine<br/>Tesseract]
    TRANS[ğŸŒ Translation Service]
  end

  %% ---------------------------
  %% Output Layer
  %% ---------------------------
  subgraph OUT["Output & Human Handoff"]
    RESP[ğŸ“¦ Response Packager<br/>Final Answer + Citations]
    REPORT[ğŸ“‘ Research Output]
    DRAFT[ğŸ“ƒ Draft Petition/Notice]
    HANDOFF[ğŸ™‹ Human Review Required<br/>Critical Legal Decisions]
  end

  %% ==========================================================
  %% FLOW: User â†’ Orchestrator
  %% ==========================================================
  U1 --> WEB --> API --> LRA
  LRA --> ROUTER
  LRA --> STATE
  LRA --> POLICY
  LRA --> AUDIT

  %% ==========================================================
  %% FLOW: Router â†’ Agents
  %% ==========================================================
  ROUTER --> CLSA
  ROUTER --> LII
  ROUTER --> LAA
  ROUTER --> LAB
  ROUTER --> DGA
  ROUTER --> CCA
  ROUTER --> LAF

  %% ==========================================================
  %% FLOW: Agents â†’ Retrieval + LLM
  %% ==========================================================
  CLSA --> RETR
  LII --> LLM
  LAA --> LLM
  LAB --> LLM
  DGA --> LLM
  CCA --> LLM
  LAF --> LLM

  RETR --> VDB
  RETR --> META
  VDB --> DOCS

  CLSA --> CIT
  LAB --> CIT
  DGA --> CIT

  %% ==========================================================
  %% FLOW: Ingestion â†’ Vector Store
  %% ==========================================================
  SRC --> SCRAPE --> PARSE --> CLEAN --> CHUNK --> EMB --> LOAD --> VDB
  PARSE --> OCR
  DGA --> TRANS

  %% ==========================================================
  %% FLOW: Final Outputs
  %% ==========================================================
  CLSA --> RESP
  LII --> RESP
  LAA --> RESP
  LAB --> RESP
  DGA --> RESP
  CCA --> RESP
  LAF --> RESP

  RESP --> REPORT
  RESP --> DRAFT
  POLICY --> HANDOFF
  RESP --> HANDOFF
