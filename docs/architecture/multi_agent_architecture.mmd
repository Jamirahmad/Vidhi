flowchart LR

subgraph L0[User Layer]
  U[User] --> UI[Streamlit UI]
  UI --> API[FastAPI Gateway]
end

subgraph L1[Orchestration Layer]
  API --> ORCH[Orchestrator]
  ORCH --> ROUTER[Task Router]
  ORCH --> STATE[Session Memory]
  ORCH --> POLICY[Safety Guardrails]
  ORCH --> AUDIT[Audit Logger]
end

subgraph L2[Agent Layer]
  ROUTER --> CLSA[CaseFinder Agent]
  CLSA --> LII[IssueSpotter Agent]
  LII --> LAA[LimitationChecker Agent]
  LAA --> LAB[ArgumentBuilder Agent]
  LAB --> DGA[DocComposer Agent]
  DGA --> CCA[ComplianceGuard Agent]
  CCA --> LAF[AidConnector Agent]
end

subgraph L3[Retrieval Layer]
  CLSA --> RETR[Hybrid Retriever]
  RETR --> VDB[(Vector Store)]
  VDB --> DOCS[(Document Store)]
  VDB --> META[(Metadata Index)]
end

subgraph L4[Model Layer]
  LLM[LLM Provider]
  EMB[Embedding Model]
end

subgraph L5[Output Layer]
  LAF --> PACK[Response Packager]
  PACK --> REPORT[Research Report]
  PACK --> DRAFT[Draft Document]
  PACK --> HANDOFF[Human Lawyer Review]
end

RETR --> EMB
LII --> LLM
LAA --> LLM
LAB --> LLM
DGA --> LLM
CCA --> LLM
PACK --> LLM
