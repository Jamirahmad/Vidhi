flowchart TB

subgraph L0[User Interaction Layer]
  U[User]
  UI[Streamlit UI or Web UI]
  API[FastAPI Gateway]
end

subgraph L1[Control and Orchestration Layer]
  LRA[Legal Reasoning Orchestrator]
  ROUTER[Task Router and Planner]
  STATE[Session State Manager]
  POLICY[Safety and Policy Guard]
  AUDIT[Audit and Trace Logger]
end

subgraph L2[Multi Agent Execution Layer]
  CLSA[CLSA CaseFinder - Precedent Retrieval]
  LII[LII IssueSpotter - Issues and Sections]
  LAA[LAA LimitationChecker - Time Bar Validation]
  LAB[LAB ArgumentBuilder - Supporting and Counter Arguments]
  DGA[DGA DocComposer - Draft Generator]
  CCA[CCA ComplianceGuard - Filing and Format Checks]
  LAF[LAF AidConnector - Legal Aid Suggestions]
end

subgraph L3[Knowledge and Retrieval Layer]
  RETR[Hybrid Retrieval Engine]
  VDB[(Vector Store - Chroma or FAISS)]
  META[(Metadata Index - SQLite or JSON)]
  DOCS[(Document Store - PDF HTML Text)]
end

subgraph L4[Model and Tool Layer]
  LLM[LLM Provider]
  EMB[Embedding Model]
  OCR[OCR Engine]
end

subgraph L5[Outputs and Human Handoff Layer]
  PACK[Response Packager - Citations and Drafts]
  REPORT[Research Summary Output]
  DRAFT[Draft Document Output]
  HANDOFF[Human Review and Lawyer Validation]
end

subgraph L6[Data Ingestion Pipeline - Offline]
  SRC[Legal Sources - SC HC Tribunals]
  ING[Downloader and Scraper]
  PARSE[Parser and OCR Extractor]
  CLEAN[Cleaner and Normalizer]
  CHUNK[Chunker]
  INDEX[Index Builder]
end


U --> UI --> API --> LRA

LRA --> ROUTER --> CLSA
CLSA --> RETR --> VDB
VDB --> PACK

PACK --> LII --> LAA --> LAB --> DGA --> CCA --> LAF --> PACK

LRA --> STATE
LRA --> POLICY
LRA --> AUDIT

RETR --> EMB
LII --> LLM
LAA --> LLM
LAB --> LLM
DGA --> LLM
CCA --> LLM

PACK --> REPORT
PACK --> DRAFT
PACK --> HANDOFF

SRC --> ING --> PARSE --> CLEAN --> CHUNK --> INDEX --> VDB
PARSE --> OCR
INDEX --> META
VDB --> DOCS
